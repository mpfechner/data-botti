<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}DataBotti{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='Logo.png') }}">
{% macro csrf_field() -%}
  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
{%- endmacro %}
</head>
<body>
    <header class="header">
        <div class="logo-container">
            <img src="{{ url_for('static', filename='Logo.png') }}" alt="Logo" class="logo">
            <img src="{{ url_for('static', filename='Botti_name.png') }}" alt="DataBotti" class="logo-text">
        </div>
        <div class="nav-buttons" style="margin-left:auto; display:flex; gap:0.5rem;">
          {% if session.get('is_admin') %}
          <a href="{{ url_for('admin.list_users') }}" class="btn">Admin</a>
          {% endif %}
          <a href="/app" class="btn">Home</a>
          {% if session.get('user_id') %}
          <form action="{{ url_for('auth.logout') }}" method="post">
            <button type="submit" class="btn">Logout</button>
          </form>
          {% endif %}
        </div>
    </header>
    <main>
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <div class="flash-container">
              {% for category, message in messages %}
                <div class="flash flash-{{ category }}" role="alert">
                  {{ message }}
                  <span class="close-btn">Ã—</span>
                </div>
              {% endfor %}
            </div>
          {% endif %}
        {% endwith %}
        {% block content %}{% endblock %}
    </main>
    {% include 'partials/footer.html' ignore missing %}
    <script>
      // Auto-dismiss after 5 seconds
      setTimeout(() => {
        document.querySelectorAll('.flash').forEach(el => {
          el.style.transition = 'opacity 0.5s ease';
          el.style.opacity = '0';
          setTimeout(() => el.remove(), 500);
        });
      }, 5000);

      // Manual close
      document.addEventListener('click', e => {
        if (e.target.classList.contains('close-btn')) {
          const flash = e.target.closest('.flash');
          if (flash) flash.remove();
        }
      });
    </script>
</body>
</html>