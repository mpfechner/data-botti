<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DataBotti – Analysis Result</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <h1>Analysis Result for {{ summary.filename }}</h1>
    {% if summary.stored_filename or summary.file_hash %}
    <p style="font-size:0.9em;color:#666;margin-top:-10px;">
      Gespeichert als: <code>{{ summary.stored_filename }}</code>
      {% if summary.file_hash %} &middot; Hash: <code>{{ summary.file_hash }}</code>{% endif %}
    </p>
    {% endif %}
    {% set d = summary.delimiter_used %}
{% if d == '\t' %}
  {% set d_label = 'Tabulator (\\t)' %}
{% elif d == ';' %}
  {% set d_label = 'Semikolon (;)' %}
{% elif d == '|' %}
  {% set d_label = 'Pipe (|)' %}
{% else %}
  {% set d_label = d %}
{% endif %}
<p class="info-box">
  Encoding: <code>{{ summary.encoding_used or 'unbekannt' }}</code>
  · Trennzeichen: <code>{{ d_label or 'unbekannt' }}</code>
</p>
    {% if summary.warnings and summary.warnings|length > 0 %}
  <div class="alert alert-warning">
    <ul style="margin-bottom:0;">
      {% for w in summary.warnings %}
        <li>{{ w }}</li>
      {% endfor %}
    </ul>
  </div>
{% endif %}

    <h2>Dataset Overview</h2>
    <ul>
        <li><strong>Rows and Columns:</strong> {{ summary.shape[0] }} rows, {{ summary.shape[1] }} columns</li>
        <li><strong>Columns:</strong> {{ summary.columns|join(', ') }}</li>
    </ul>

    <h2>Sample Data (first 10 rows)</h2>
    {{ summary.head|safe }}

    <h2>Descriptive Statistics</h2>
    {{ summary.description|safe }}
    {% if summary.insights %}
<hr>
<h2>Auto-Interpretation</h2>

{% if summary.insights.missing %}
<p><strong>Fehlwerte:</strong>
  Zeilen mit mind. einem Missing: {{ summary.insights.missing.rows_with_missing }} von {{ summary.shape[0] }}.
</p>
{% if summary.insights.missing.per_column %}
<p><strong>Fehlwerte pro Spalte:</strong>
  {% for k, v in summary.insights.missing.per_column.items() %}
    {{ k }}={{ v }}{% if not loop.last %}, {% endif %}
  {% endfor %}
</p>
{% endif %}
{% endif %}

{% if summary.insights.datetime %}
<h3>Zeitspalten</h3>
<ul>
  {% for col, stats in summary.insights.datetime.items() %}
  <li><code>{{ col }}</code>: {{ stats.min }} – {{ stats.max }}</li>
  {% endfor %}
</ul>
{% endif %}

{% if summary.insights.numeric %}
<h3>Numerische Spalten</h3>
<table class="table table-sm table-striped table-hover">
  <thead>
    <tr>
      <th>Spalte</th><th>count</th><th>mean</th><th>std</th>
      <th>min</th><th>25%</th><th>median</th><th>75%</th><th>max</th>
    </tr>
  </thead>
  <tbody>
    {% for col, s in summary.insights.numeric.items() %}
    <tr>
      <td><code>{{ col }}</code></td>
      <td>{{ s.count }}</td>
      <td>{{ "%.6g"|format(s.mean) }}</td>
      <td>{{ s.std is not none and ("%.6g"|format(s.std)) or "–" }}</td>
      <td>{{ "%.6g"|format(s.min) }}</td>
      <td>{{ "%.6g"|format(s.q25) }}</td>
      <td>{{ "%.6g"|format(s.median) }}</td>
      <td>{{ "%.6g"|format(s.q75) }}</td>
      <td>{{ "%.6g"|format(s.max) }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endif %}

{% if summary.insights.categorical %}
<h3>Kategorische Spalten</h3>
<table class="table table-sm table-striped table-hover">
  <thead>
    <tr>
      <th>Spalte</th><th>count</th><th>unique</th><th>top</th><th>freq</th>
    </tr>
  </thead>
  <tbody>
    {% for col, s in summary.insights.categorical.items() %}
    <tr>
      <td><code>{{ col }}</code></td>
      <td>{{ s.count }}</td>
      <td>{{ s.unique }}</td>
      <td>{{ s.top if s.top is not none else "–" }}</td>
      <td>{{ s.freq if s.freq is not none else "–" }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endif %}
{% endif %}

    {% if columns %}
    <hr>
    <h2>Spaltenübersicht</h2>
    <table class="table table-sm table-striped table-hover">
      <thead>
        <tr>
          <th>#</th>
          <th>Spaltenname</th>
          <th>Datentyp</th>
          <th>Nullable</th>
          <th>Distinct</th>
          <th>Min</th>
          <th>Max</th>
        </tr>
      </thead>
      <tbody>
      {% for c in columns %}
        <tr>
          <td>{{ c.ordinal }}</td>
          <td>{{ c.name }}</td>
          <td>{{ c.dtype }}</td>
          <td>{{ 'Ja' if c.is_nullable else 'Nein' }}</td>
          <td>{{ c.distinct_count if c.distinct_count is not none else '–' }}</td>
          <td>{{ c.min_val if c.min_val else '–' }}</td>
          <td>{{ c.max_val if c.max_val else '–' }}</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
    {% endif %}

    <p><a href="{{ url_for('index') }}">Upload another file</a></p>
</body>
</html>